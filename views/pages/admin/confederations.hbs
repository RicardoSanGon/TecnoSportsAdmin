<!-- Gestión de Confederaciones - Diseño Moderno con Colores Verdes -->
<div class="min-h-screen bg-gradient-to-br from-primary-50 via-primary-100 to-primary-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Header Section -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-4xl font-bold text-gray-900 mb-2">
            <i class="fas fa-globe-americas mr-3 text-primary-600"></i>
            Gestión de <span class="bg-gradient-to-r from-primary-400 to-primary-600 bg-clip-text text-transparent">Confederaciones</span>
          </h1>
          <p class="text-lg text-gray-600">Administrar confederaciones deportivas</p>
        </div>
        <button id="add-confederation-btn" class="bg-primary-600 text-white px-6 py-3 rounded-lg hover:bg-primary-700 transition-colors duration-200 shadow-lg">
          <i class="fas fa-plus mr-2"></i>Agregar Confederación
        </button>
      </div>
    </div>

    <!-- Tabla de confederaciones -->
    <div class="bg-white rounded-lg shadow-lg">
      <div class="p-6 border-b border-gray-200">
        <div class="flex justify-between items-center">
          <h2 class="text-xl font-semibold text-gray-800">Lista de Confederaciones</h2>
        </div>
      </div>

      <div class="p-6 overflow-x-auto">
        <table id="confederationsTable" class="w-full text-sm text-left">
          <thead class="text-xs text-gray-700 uppercase bg-gray-50">
            <tr>
              <th class="px-6 py-3">ID</th>
              <th class="px-6 py-3">Nombre</th>
              <th class="px-6 py-3">Fecha de Creación</th>
              <th class="px-6 py-3 text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {{#each confederations}}
              <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">#{{this.id}}</td>
                <td class="px-6 py-4 font-semibold text-gray-900">{{this.name}}</td>
                <td class="px-6 py-4 text-gray-500">{{this.created_at}}</td>
                <td class="px-6 py-4 text-center">
                  <div class="flex gap-2 justify-center">
                    <button onclick="editConfederation({{this.id}})" class="p-2 text-primary-600 hover:text-white hover:bg-primary-600 rounded-lg transition-all duration-200" title="Editar">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteConfederation({{this.id}})" class="p-2 text-red-600 hover:text-white hover:bg-red-600 rounded-lg transition-all duration-200" title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Confederaciones - Centrado y compacto -->
<div id="confederation-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900 bg-opacity-50">
  <div class="relative w-full max-w-md bg-white rounded-lg shadow-xl">
    <!-- Modal header -->
    <div class="flex items-center justify-between p-4 border-b rounded-t">
      <h3 class="text-lg font-semibold text-gray-900" id="confederation-modal-title">
        Agregar Nueva Confederación
      </h3>
      <button type="button" id="confederation-modal-close-btn" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
      </button>
    </div>
    <!-- Modal body -->
    <div class="p-4">
      <form id="confederation-form">
        <input type="hidden" id="confederation-id" value="">
        <div class="space-y-4">
          <div>
            <label for="confederation-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Confederación</label>
            <input type="text" id="confederation-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500" required placeholder="Ej: Confederación Este">
            <p class="text-xs text-gray-500 mt-1">Ingresa un nombre único para la confederación</p>
          </div>
        </div>
        <div class="mt-6 flex gap-3">
          <button type="submit" class="flex-1 bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 transition-colors duration-200">
            <i class="fas fa-save mr-2"></i>Guardar
          </button>
          <button type="button" id="cancel-confederation-btn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-200">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Funciones globales para los botones en el HTML
window.editConfederation = function(id) {
  console.log('Edit confederation called with ID:', id);
  fetchConfederationData(id);
};

window.deleteConfederation = function(id) {
  console.log('Delete confederation called with ID:', id);
  if (confirm('¿Estás seguro de que quieres eliminar esta confederación? Esta acción no se puede deshacer y puede afectar a los equipos asociados.')) {
    deleteConfederationById(id);
  }
};

// Funciones del modal
function showConfederationModal() {
  const modal = document.getElementById('confederation-modal');
  if (modal) {
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    console.log('Confederation modal shown');
  }
}

function hideConfederationModal() {
  const modal = document.getElementById('confederation-modal');
  if (modal) {
    modal.classList.add('hidden');
    document.body.style.overflow = 'auto';
    console.log('Confederation modal hidden');
    
    const form = document.getElementById('confederation-form');
    if (form) {
      form.reset();
      document.getElementById('confederation-id').value = '';
    }
  }
}

// Abrir modal para agregar/editar confederación
function openConfederationModal(confederationData = null) {
  const title = document.getElementById('confederation-modal-title');
  const nameInput = document.getElementById('confederation-name');
  const idInput = document.getElementById('confederation-id');
  
  if (title) {
    title.textContent = confederationData ? 'Editar Confederación' : 'Agregar Nueva Confederación';
  }
  
  // Limpiar formulario
  const form = document.getElementById('confederation-form');
  if (form) form.reset();
  
  if (confederationData) {
    if (nameInput) nameInput.value = confederationData.name || '';
    if (idInput) idInput.value = confederationData.id || '';
  } else {
    if (idInput) idInput.value = '';
  }
  
  showConfederationModal();
  
  // Enfocar el campo de nombre
  if (nameInput) {
    setTimeout(() => nameInput.focus(), 100);
  }
}

// Obtener datos de una confederación específica
async function fetchConfederationData(id) {
  const token = localStorage.getItem('authToken');
  try {
    const response = await fetch(`/api/confederations/${id}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });
    
    if (response.ok) {
      const result = await response.json();
      console.log('Confederation data received:', result.data);
      openConfederationModal(result.data);
    } else {
      throw new Error('Error al obtener datos de la confederación');
    }
  } catch (error) {
    console.error('Error fetching confederation:', error);
    alert('Error al cargar los datos de la confederación: ' + error.message);
  }
}

// Eliminar confederación
async function deleteConfederationById(id) {
  const token = localStorage.getItem('authToken');
  try {
    const response = await fetch(`/api/confederations/${id}`, {
      method: 'DELETE',
      headers: { 'Authorization': `Bearer ${token}` }
    });
    
    if (response.ok) {
      alert('Confederación eliminada exitosamente');
      window.location.reload();
    } else {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Error al eliminar la confederación');
    }
  } catch (error) {
    console.error('Error deleting confederation:', error);
    alert('Error al eliminar la confederación: ' + error.message);
  }
}

// Guardar confederación (crear o actualizar)
async function saveConfederation() {
  const token = localStorage.getItem('authToken');
  
  const id = document.getElementById('confederation-id').value;
  const name = document.getElementById('confederation-name').value.trim();
  
  console.log('Form values:', { id, name });
  
  if (!name) {
    alert('Por favor ingresa el nombre de la confederación');
    document.getElementById('confederation-name').focus();
    return;
  }
  
  if (name.length < 2) {
    alert('El nombre debe tener al menos 2 caracteres');
    document.getElementById('confederation-name').focus();
    return;
  }
  
  const method = id ? 'PATCH' : 'POST';
  const url = id ? `/api/confederations/${id}` : '/api/confederations';
  const body = {
    name
  };
  
  console.log('Sending data:', body);
  
  try {
    const response = await fetch(url, {
      method,
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(body)
    });
    
    if (response.ok) {
      const result = await response.json();
      console.log('Save response:', result);
      alert(id ? 'Confederación actualizada exitosamente' : 'Confederación creada exitosamente');
      hideConfederationModal();
      window.location.reload();
    } else {
      const errorData = await response.json();
      console.error('Save error:', errorData);
      throw new Error(errorData.message || 'Error al guardar la confederación');
    }
  } catch (error) {
    console.error('Error saving confederation:', error);
    alert('Error al guardar la confederación: ' + error.message);
  }
}

// Inicialización cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM Content Loaded - Initializing confederations page');
  
  // Inicializar DataTable con jQuery
  if (typeof $ !== 'undefined') {
    $('#confederationsTable').DataTable({
      responsive: true,
      language: {
        url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json'
      },
      order: [[0, 'desc']], // Ordenar por ID descendente
      columnDefs: [
        { orderable: false, targets: -1 } // Deshabilitar ordenación en la columna de acciones
      ]
    });
  }
  
  // Event listeners del modal
  const addBtn = document.getElementById('add-confederation-btn');
  if (addBtn) {
    addBtn.addEventListener('click', function() {
      console.log('Add confederation button clicked');
      openConfederationModal();
    });
  }
  
  const closeBtn = document.getElementById('confederation-modal-close-btn');
  if (closeBtn) {
    closeBtn.addEventListener('click', function() {
      console.log('Close button clicked');
      hideConfederationModal();
    });
  }
  
  const cancelBtn = document.getElementById('cancel-confederation-btn');
  if (cancelBtn) {
    cancelBtn.addEventListener('click', function() {
      console.log('Cancel button clicked');
      hideConfederationModal();
    });
  }
  
  // Click fuera del modal
  const modal = document.getElementById('confederation-modal');
  if (modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        console.log('Clicked outside modal');
        hideConfederationModal();
      }
    });
  }
  
  // Formulario
  const form = document.getElementById('confederation-form');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      console.log('Confederation form submitted');
      saveConfederation();
    });
  }
  
  // Tecla Escape para cerrar modal
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const modal = document.getElementById('confederation-modal');
      if (modal && !modal.classList.contains('hidden')) {
        hideConfederationModal();
      }
    }
  });
  
  console.log('All confederation event listeners attached');
});
</script>
